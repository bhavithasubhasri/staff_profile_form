<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Directory</title>
    <link rel="stylesheet" href="/css/stafflist.css">
        
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Staff Directory</h1>
            <p>Manage and view all staff members</p>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search staff by name, position, or code...">
            </div>
            <a href="/" class="btn btn-primary">+ Add New Staff</a>
        </div>

        <div id="staffGrid" class="staff-grid">
            <div class="loading">Loading staff data...</div>
        </div>
    </div>

    <script>
        let allStaff = [];

        // Load staff data
        async function loadStaff() {
            try {
                const response = await fetch('/staff');
                allStaff = await response.json();
                displayStaff(allStaff);
            } catch (error) {
                console.error('Error loading staff:', error);
                document.getElementById('staffGrid').innerHTML = 
                    '<div class="no-results">Error loading staff data</div>';
            }
        }

        // Display staff cards
        function displayStaff(staff) {
            const grid = document.getElementById('staffGrid');
            
            if (staff.length === 0) {
                grid.innerHTML = '<div class="no-results">No staff members found</div>';
                return;
            }

            grid.innerHTML = staff.map(member => `
                <div class="staff-card">
                    <div class="staff-header">
                        <img src="${member.profile_image ? '/uploads/' + member.profile_image : 'https://example.com/path/to/avatar2.png'}" 
                             alt="Profile" class="staff-avatar">
                        <div class="staff-info">
                            <h3>${member.first_name} ${member.last_name}</h3>
                            <div class="staff-position">${member.job_position || 'N/A'}</div>
                            <span class="staff-status">${member.status || 'Active'}</span>
                        </div>
                    </div>
                    
                    <div class="staff-details">
                        <div class="detail-row">
                            <span class="detail-label">Staff Code:</span>
                            <span class="detail-value">${member.staff_code}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Email:</span>
                            <span class="detail-value">${member.email}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone:</span>
                            <span class="detail-value">${member.phone || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Workplace:</span>
                            <span class="detail-value">${member.workplace || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Joined:</span>
                            <span class="detail-value">${new Date(member.createdAt).toLocaleDateString()}</span>
                        </div>
                    </div>
                    
                    <div class="staff-actions">
                        <a href="/staff/${member._id}" class="btn btn-info btn-sm">View</a>
                        <button onclick="editStaff('${member._id}')" class="btn btn-warning btn-sm">Edit</button>
                        <button onclick="deleteStaff('${member._id}')" class="btn btn-danger btn-sm">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Search functionality
        function searchStaff(query) {
            const filtered = allStaff.filter(member => {
                const searchText = query.toLowerCase();
                return (
                    member.first_name.toLowerCase().includes(searchText) ||
                    member.last_name.toLowerCase().includes(searchText) ||
                    member.staff_code.toLowerCase().includes(searchText) ||
                    (member.job_position && member.job_position.toLowerCase().includes(searchText)) ||
                    member.email.toLowerCase().includes(searchText)
                );
            });
            displayStaff(filtered);
        }

        // Edit staff (redirect to edit page)
        function editStaff(id) {
            window.location.href = `/edit/${id}`;
        }

        // Delete staff
        async function deleteStaff(id) {
            if (confirm('Are you sure you want to delete this staff member?')) {
                try {
                    const response = await fetch(`/staff/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadStaff(); // Reload the list
                        alert('Staff member deleted successfully');
                    } else {
                        alert('Error deleting staff member');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error deleting staff member');
                }
            }
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchStaff(e.target.value);
        });

        // Load staff on page load
        loadStaff();
    </script>
</body>
</html>